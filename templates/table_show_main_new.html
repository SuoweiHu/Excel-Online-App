<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
    <!-- ====================================================== -->
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='layui/dist/css/layui.css') }}"  media="all">
    <!-- <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script> -->
    <script src="{{ url_for('static', filename='jquery/min.js') }}"></script>
    <style type="text/css">
        /*<!-- 居中的样式 -->*/
        /* .table_mask {
            position: relative;
            height: 1080px;
            }
        .table_center{
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 1920px;
            height: 1000px;
        } */
        .table_mask {
            position: relative;
            height: 85vh;
            }
        .table_center{
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 1920px;
            height: 82vh;
        }
        /* .layui-table-cell{overflow: visible !important;} */
        /* td .layui-form-select{ margin-top: -10px; margin-left: -15px; margin-right: -15px;}    */
    </style>
    <title>Excel Online</title>
</head>
<body>
    <!-- ====================================================== -->

    <div style="padding: 20px; background-color: #ffffff;">
        <form action="/table/all" method="get" style="padding-left: 10px;">
            <button style="display: inline; float: left;" type="submit" class="layui-btn layui-btn-primary layui-btn-m layui-btn-radius" lay-submit="" lay-filter="demo1"> 返回全部表格 </button>
        </form>
        <br>
        <fieldset class="layui-elem-field " style="margin-top: 30px; ">
            <legend>中信银行填报系统</legend>
            <div class="table_mask">
                <!-- 以上为居中设置 -->
                <div class="table_center" style="width:95%;">

                    <table id="_MAIN_TABLE_RENDER_ID_" lay-filter="_MAIN_TABLE_RENDER_FILTER_" ></table>
                    <br>
                    <div>
                        <span>
                            <div id="page_component" style="display: inline; float: right; margin-right: 30px;"></div>
                            <form action="/file" method="post" id="file_form_1" enctype="multipart/form-data" style="display: inline; float: left; ">
                                <input type="file" accept=".xls,.xlsx" name="stuff_file"  id="selectedFile_1" size="60" style="display: none;">
                                <input style="display: {{file_upload_section}};" type="button" class="layui-btn " value="提交任务" onclick="document.getElementById('selectedFile_1').click();" />
                            </form>
                        </span>
                    </div>
                </div>
                <!-- 以下为居中设置 -->
            </div>
        </fieldset>
    </div>

    <!-- ====================================================== -->
    <!-- layui的默认js文件 (包含一些基本的样式和动画) -->
    <script src="{{ url_for('static', filename='layui/dist/layui.js') }}" charset="utf-8"></script>

    <!-- Laytpl 模版引擎 解析字符成HTML代码 -->
    <!-- <script id="_demo_" type="text/html"> -->
    <script>String.prototype.format =function () {var args = arguments;return this.replace(/\{(\d+)\}/g, function(m, i){return args[i];});};</script>

    <!-- Html表格的自动渲染设置 -->
    <script>
        layui.use(['table', 'laytpl','layer'], function(){
            var laytpl= layui.laytpl;
            var table = layui.table;
            
            //更改Layui模版组件的的分隔符
                // laytpl.config({          // 经过测试不可使用 （和Jinja2渲染分隔符冲突）
                //     open:  '<%%',        // 改为使用 \{\{""\}\} 转义成为string格式
                //     close: '%%>'         // 例子：
                // });                      // \{\{" \{\{<div> Hello World ! </div>\}\} "\}\}
            //选择被渲染的表格元素
            table.render({
                title: "中信银行填报系统"
                ,elem: '#_MAIN_TABLE_RENDER_ID_'
            //高宽设置
                // ,width:  1920                    //1080p
                // ,height: 950                     //1080p
                ,height : window.innerHeight*0.75    //自适应-1
                // ,height :85vh                    //自适应-2
            //分页
                ,page: true                         //开启分页
                ,limit: 20                          //每页条数
                // ,page: {theme: '#c00'}           //开启分页主题
                ,limits:[5,10,15,20]           //分页选项

            //数据接口
                ,url: '/api/dataMain'               //数据接口
            
            // ----------------------------------------
            //表头设置 （渲染的时候会根据这里设置的field为单元格设置样式）     
                ,cols: [[    
                    {field: 'tb_name',              title: '任务名',   width:250, sort: true, unresize:false, align:'center', fixed: 'left'}, 
                    {field: 'upload_operator',      title: '上传用户', width:120, sort: true, unresize:true, align:'center',}, 
                    {field: 'upload_time',          title: '上传时间', width:200, sort: true, unresize:true, align:'center',}, 
                    {field: 'due',                  title: '截止日期', width:200, sort: true, unresize:true, align:'center',}, 
                    {field: 'count_completed',      title: '完成行数', width:120, unresize:true, align:'center',}, 
                    // {field: 'count_uncompleted',    title: '未完成行数'}, 
                    {field: 'count_total',          title: '总计行数', width:120, unresize:true, align:'center',}, 
                    {field: 'percentage',           title: '完成度'  , width:120, unresize:true, align:'center',}, 
                    {field: 'url_edit',             title: '123', width:220, unresize:true, align:'center',}, 
                    {field: 'url_edit_mustFill',    title: '123', width:220, unresize:true, align:'center',}, 
                    {field: 'url_edit_dueNComment', title: '123', width:220, unresize:true, align:'center',}, 
                    {field: 'url_delete',           title: '123', width:220, unresize:true, align:'center',}, 
                ]]
            });


            //监听排序事件 
            table.on('sort(_MAIN_TABLE_RENDER_FILTER_)', function(obj){ 
                console.log('监听到重新排序:')
                console.log('\t'+this);             //当前排序的 th 对象 (HTNL元素)
                console.log('\t'+obj.field);        //当前排序的字段名
                console.log('\t'+obj.type);         //当前排序类型 asc/desc/null
                
                //根据当前排序的字段，重新向服务端发送请求
                table.reload('_MAIN_TABLE_RENDER_ID_', {
                    initSort: obj                   //记录初始排序，如果不设的话，将无法标记表头的排序状态。
                    ,url: '/api/dataMain'           //服务端的异步数据接口
                    ,where: {                       //请求参数（注意：这里面的参数可任意定义，并非下面固定的格式）
                        field: obj.field            //排序字段
                        ,order: obj.type            //排序方式
                    }
                });
                
                //弹窗提示数据已经重新加载
                // layer.msg('服务端排序。<br> 排序列:'+ obj.field + '， 排序方式:' + obj.type, {time:1000});
            });

        });
        
    </script>

     <!-- 自动上传文件 -->
     <script>
        document.getElementById("selectedFile_1").onchange = function() {
            document.getElementById("file_form_1").submit();
        };
    </script>
    

</body>
</html>