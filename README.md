# Excel-Online-App
 
解决业务人员在没有下载工具的情况下通过移动端上传模版对账文件，或者填写其负责行的信息。



## 数据格式
传入xlxs格式的excel文件如下，

2020第一季度.xlsx
```
{
"行号": 3217863, 
"项目名": "总计",
…, 
"操作员":胡所未,
"更改时间":2020.02.11 00:00:00 
}
```

读取后保存到Mongo数据库，每一个表格都会单独得被作为一个集合保存到同一个数据库中
```
2020第一季度：
{_id:123djksaldjskal, "行号":..., "操作员":...}，
{_id:234djksaldjskal, "行号":..., "操作员":...}
{_id:345djksaldjskal, "行号":..., "操作员":...}

2020第二季度：
{_id:456djksaldjskal, "行号":..., "操作员":...}，
{_id:567djksaldjskal, "行号":..., "操作员":...}
{_id:789djksaldjskal, "行号":..., "操作员":...}

...:
    ...
    ...
    ...
```



## 笔记

**2020.12.28 已经做好的功能**

文件读写
1. 从Excel文件中读取数据存为自定义类TableData, 内含方法可一转为Dict/Json格式 (TableData包含了: 表格名, 表格属性, 内容, 操作员)
2. 待完成 导出为Excel的功能

数据库
1. 从Excel文件中读取后, 将Json/ Dict格式的变量直接作为文档保存, 该文档的 _id 为文件名(包括后缀)的哈希值(预置加密方法可选SHA1, MD5等)
2. 从数据库中通过刚刚的 _id 读取文档, 并转回自定义类TableData类型 (现在的)

前端
1. 使用Json2Html库在DataTable类里面写了将数据转化成Html table的方法, 现存问题
    - 怎么将None值替换成可输入的文本框
    - 怎么在通过文本框的name定位输入数据的位置
    - 强制用户完成一行的数据, 且只能完成一行, 并只提交这一行(可不可以每一行单独用一个form)
    - json2html transformer 怎么使用
2. 上传文件功能(_id如上所述通过hash生成)

Web 应用
1. 登陆功能 - 登陆之后可以增删改, 上传文件模版


几种方法解决只 "一个用户一次只上传一行"
1. 每一行做一个form, 有单独的提交按钮
2. 使用javascript当用户点击某一行的时候, 自动将提交的parameter改成该行对应的(例如upload/3 表示上传第三行)


**2020.12.28 需求更改**


1. 数据库存储的数据结构改成 {行号: {数据}}
	例如: 
	{3217863: 
		{"行号": 3217863, 
		"项目名": "总计",
		…, 
		"操作员":胡所未,
		"更改时间":2020.02.11 00:00:00 },
	3217864: {…},
	3217865: {…},
	3217866: {…}
	}

2. 一个用户只有一行要填 !!!!!! (所以只管加required 和 submit 好了) 二级页面：地址。/table_main 三级页面 /row_all 最终更改页面 /row_edit

- 一级页面：展示所有表单
- 二级页面：展示表单所有（允许更改的）行，每一行有编辑按钮，点击进入三级页面（admin可以有权限浏览所有表单）
- 三级页面：使用二级页面的模版做，只展示某一行并可以更改（在TableData里加入参选项将空缺值替换为input：text）


3. 选择表格的下拉框做成 季度表格 的形式(每行是一个表格加上完成度)

4. 季度表格 加上 完成度选项 (每个表哥的完成度由已经填写的行数 VS 总行数) 并且用完成度排序 (从高到低, 从低到高)

5. 判断行是否完成可以通过最后两个属性（操作员+时间）是否填写完成

6. 静态网页模版(需要的功能有: form, input text, table, h2, )最后再做这个


问题
1. 一个用户只有权限填写一行（特定行号）的内容，那么就得有个前台把用户名和数据库中的（用户，允许更改的行号）对比以只展示有权限的行号的功能/机制
2. 需要在原表中包含这个用户vs行号的子表吗，还是暂时先默认每个用户只能读哪一行/展示所有行然后只给更改某一行

如果已经更改就不能删除 的功能?????


2021.01.12
更新需求
1.预设内容不可编辑
2.子用户如733101，也显示其完成数，全部数，完成度
3.日期格式后面多了00:00:00，这个能不能去掉？
4.上传的表格，目前是根据空白单位格来判断是否需要填报，这个能不能优化，比如某列设置成必填，某列设置成选填？也可以考虑上传成功后，由上传用户去设置，也可以上传之前在表格中预设


## 交流
我昨天做了个selenium爬用浏览器渲染好的网易云音乐的用户和其歌单，然后保存到本地的MongoDB数据库的爬虫

我现在想做个统计的功能，在网页端用户点击一个按钮发送表单数据（比如说前100首最常听的歌）， 后段访问数据库得到结果返给网页端展示

但我现在还不知道后端是怎么接收前端用POST或GET发送的数据，也不知道后端怎么返数据给网页。我查了下看接受部分有些是用Flask框架实现的，可以问一下我从哪里开始好呢

----------

我昨天把官方中文文档的快速上手过了一遍，基本上得到我想要的功能了。但是有一些实现上的东西我可能还是不太明白，例如说服务器是怎么通过WSGI调用对应的web应用处理请求返回（我路上看的一些网上的视频教程基本上开头几篇讲的都是这些）

请问这些内容在现阶段是需要了解的吗，然后我还需要继续看官网上教程部分里的其他内容吗（包括了：项目布局，应用设置，SQLite数据库，蓝图，视图等更加细节的使用方法）


----------

刚刚那个全局的我查了一圈好像相关的例子比较少,stackoverflow上的很多相关问题也都没有人答

都是说为了线程安全, Flask不允许在不同request之前传变量,在同一次request里有方法可以用ApplicationContextGlobal (flask.g + @app.before_request)来存变量,不同request之间也可以通过session (flask.session) 传一些简单的JsonSerializable的类. 

但是像database这种复杂类都是每次请求都开启关闭一次(看的官方的sqlite例子里好像是这么用的)

网上推荐的一些解决方案有: 在用户端存一个user/session id,在服务器端session cache存储这个用户的线程实例, global dict(试了好像不行,跟其他全局变量就没区别)

要不我先就简化下逻辑做一个每次登陆只能爬一次的这种先,做完了帮您看有需求的先

----------

我昨天想把之前做的数据库，获取网页和解析部分分别封装成几个个类（可能是没有必要，但是我还是想尝试下...）然后因为原来做的都是全局函数变量这种，有很多互相依赖的关系导致模组分离很困难，可以的话我能不能中午来请教下您

然后还有这个网页的样式，现阶段我暂时还没有做任何样式表，暂时放着不管您看可以吗

可不可以跟您确认下, 程哥你给我这个内网的redis,是用来存上次说的做不来的"全局变量",例如 一次浏览器和服务器的交互的会话中想保存的一个自定义类的实例 (我在网上找到一个用pickle模组来在python里serialize/deserialize对象的, 这是链接 https://stackoverflow.com/questions/43283469/storing-a-custom-python-object-in-redis)
---------- 

程哥问一下上次您说的每个用户只有权限更改一行, 这个权限相关的功能是怎么传进来的呢, 是跟空excel表的一起作为一个文件呢还是什么另外的方法

